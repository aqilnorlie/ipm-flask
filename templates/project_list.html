<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>(ICT502) IPM | Project List</title>

	<!-- Google Font: Source Sans Pro -->
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
	<!-- Font Awesome -->
	<!-- <link rel="stylesheet" href="../static/plugins/fontawesome-free/css/all.min.css"> -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
	<!-- iCheck -->
	<link rel="stylesheet" href="../static/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
	<!-- JQVMap -->
	<link rel="stylesheet" href="../static/plugins/jqvmap/jqvmap.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="../static/dist/css/adminlte.min.css">
	<!-- overlayScrollbars -->
	<link rel="stylesheet" href="../static/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
	<!-- DataTables -->
	<link rel="stylesheet" href="../static/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" href="../static/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
	<link rel="stylesheet" href="../static/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css">
</head>
<style>
	.card-header {
		background-color: rgba(0,0,0,.03);
		border-top: 1px solid rgba(0,0,0,.125);
		border-bottom: 1px solid rgba(0,0,0,.125);
		color: #6b6b6b;
	}

	.checked {
		color: orange;
	}

	.fa-star {
		cursor: pointer;
	}

	.small-text {
		font-size: 14px;
	}

	.select2-container {
		width: 100% !important;
		padding: 0;
	}

	.table td {
		padding: .4rem !important;
	}

	.inbtn {
		display: inline;
		justify-content: center;
		align-items: center;
		/*width: 1%;*/
		height: 1%;
		margin-left: 5.5px;
	}

	tr.selected {
		background-color: #e6e6e6;
	}

	th {
		background-color: rgba(41, 156, 219, .3);
		white-space: nowrap;
		text-align: center;
		vertical-align: middle;
	}

	#team_table th,
	#team_table td {
		border: 1px solid #e1e6ea !important;
	}

	.td-center {
		text-align: center;
		vertical-align: middle;
	}

	.not-allowed {
		cursor: not-allowed;
	}

	.margin-for-icon {
		margin-right: 5px;
	}

	.projectSelectionTitle {
		display: inline-block !important;
		margin-right: 5px;
	}

	.projectSelectionDropdown {
		padding: 0;
		display: inline-block !important;
		width: auto;
	}

	.overflowY {
		overflow-y: auto;
		/* height: 400px !important; */
	}

	.btnPadding {
		padding-left: 4px;
		padding-right: 4px;
		padding-bottom: 0.1px;
		padding-top: 0.1px;
	}

	.btnPaddingbtn {
		padding-left: 6px;
		padding-right: 6px;
		padding-bottom: 0.1px;
		padding-top: 0.1px;
	}

	.textareaDesc {
		height: 150px !important;
	}

	.padding-team-member-table {
		padding-left: 5px;
	}

	.file-link {
		color: #0ca4ca;
	}

	.forAlert {
		margin-bottom: 0px;
		font-size: 12px;
	}

	.hidden {
		display: none;
	}

	.no-data-tree-message {
		display: none;
		margin-top: 110px;
		margin-bottom: 110px;
	}

	.project-manager-label {
		font-weight: 500;
	}

	.project-manager-text {
		background-color: rgb(233, 236, 239);
		opacity: 1;
	}

	.paddingBtnAddProject {
		padding-top: 2px;
		padding-bottom: 2px;
		padding-left: 4px;
		padding-right: 4px;
	}
</style>

<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">

		<!-- Preloader -->
		<div class="preloader flex-column justify-content-center align-items-center">
			<img class="animation__shake" src="../static/dist/img/AdminLTELogo.png" alt="AdminLTELogo" height="60"
				width="60">
		</div>

		<!-- Navbar -->
		<nav class="main-header navbar navbar-expand navbar-white navbar-light">
			<!-- Left navbar links -->
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
				</li>
				<li class="nav-item d-none d-sm-inline-block">
					<a href="index3.html" class="nav-link">Home</a>
				</li>
			</ul>
			<!-- Right navbar links -->
			<ul class="navbar-nav ml-auto">
				<!-- Messages Dropdown Menu -->
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-comments"></i>
						{% if count_noti >= 1 %}
						<span class="badge badge-danger navbar-badge">{{count_noti}}</span>
						{% endif %}
					</a>
					<div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
						{% for noti in notification %}
						<a href="#" class="dropdown-item join_request" data-noti-id = "{{noti['NOTI_ID']}}" data-project-accept ="{{noti['PROJECT_ID']}}" data-user-id="{{noti['USER_ID']}}" style="overflow: scroll;">
						<div class="media">
							<div class="media-body">
							<h3 class="dropdown-item-title">
								{{noti["FULL_NAME"]}} Request to join Project : {{noti["PROJECT_NAME"]}}
							</h3>
							<p class="text-sm">Click This to accept</p>
							</div>
						</div>
						<!-- Message End -->
						</a>
						<div class="dropdown-divider"></div>
						{% endfor %}
					</div>
				</li>
			</ul>
		</nav>
		<!-- /.navbar -->

		<!-- include sidebar file -->
		{% include 'sidebar.html' %}
		<!-- end include file -->

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<div class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-9">
							<h1 class="main-title">Project List</h1>
						</div><!-- /.col -->
						<div class="col-3">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active">Project List</li>
							</ol>
						</div><!-- /.col -->
					</div><!-- /.row -->
				</div><!-- /.container-fluid -->
			</div>
			<!-- /.content-header -->

			<!-- Main content -->
			<section>
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<div class="card mb-3">
								<div class="card-body">
									<div class="table-responsive">
										<table id="example2" class="table table-bordered table-hover">
											<thead>
												<tr>
                                                    <th>NO.</th>
                                                    <th>PROJECT NAME</th>
                                                    <th>JOIN STATUS</th>
                                                    <th>ACCESS STATUS</th>
                                                    <th>ACTION</th>
												</tr>
											</thead>
											<tbody>
                                                {% for p in projects %}
                                                <tr>
                                                    <td class="td-center">{{ p["iter"] }}.</td>
                                                    <td>{{p['NAME']}}</td>
                                                    <td class="td-center"><i>{{p["RESULT"]}}</i></td>
                                                    <td class="td-center">{{p["STATUS"]}}</td>
													{% if p["RESULT"] == "joined" %}
														<td class="td-center"><button type="button" disabled id="btn_join_project" class="btn_join_project btn btn-danger btn-sm"
														title="Join Project" data-project-id="{{p['ID']}}" name="project_id">
														<i class="fa-solid fa-right-to-bracket"></i></button></td>
													{% else %}
                                                    <td class="td-center"><button type="button" id="btn_join_project" class="btn_join_project btn btn-success btn-sm"
													title="Join Project" data-project-id="{{p['ID']}}" data-access="{{p['STATUS']}}" name="project_id">
													<i class="fa-solid fa-right-to-bracket"></i></button></td>
													{% endif %}

                                                </tr>
                                                {% endfor %}
											</tbody>
											<tfoot>
												<tr>
                                                    <th>NO.</th>
                                                    <th>PROJECT NAME</th>
                                                    <th>JOIN STATUS</th>
                                                    <th>ACCESS STATUS</th>
                                                    <th>ACTION</th>
												</tr>
											</tfoot>
										</table>
									</div> <!-- /table-responsive -->
								</div>
							</div>
						</div>
					</div> <!-- /row -->
				</div>
			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->
		<footer class="main-footer">
			<strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">Project Management system.io</a>.</strong>
			All rights reserved.
			<div class="float-right d-none d-sm-inline-block">
				<b>Version</b> 3.2.0
			</div>
		</footer>

		<!-- Control Sidebar -->
		<aside class="control-sidebar control-sidebar-dark">
			<!-- Control sidebar content goes here -->
		</aside>
		<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->

	<!-- Modal -->
	<div class="modal fade" id="modal_join" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<h5 class="modal-title" id="modal_label_change"></h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				</div>
				<div class="msg-alert"></div>
				<div class="modal-body"></div>
				<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button id="comfirm_join" type="button" class="btn btn-primary">Join</button>
				</div>
			</div>
		</div>
  </div>

	<!-- jQuery -->
	<script src="../static/plugins/jquery/jquery.min.js"></script>
	<!-- jQuery UI 1.11.4 -->
	<script src="../static/plugins/jquery-ui/jquery-ui.min.js"></script>
	<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
	<script>
		$.widget.bridge('uibutton', $.ui.button)
	</script>
	<!-- Bootstrap 4 -->
	<script src="../static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- ChartJS -->
	<script src="../static/plugins/chart.js/Chart.min.js"></script>
	<!-- JQVMap -->
	<script src="../static/plugins/jqvmap/jquery.vmap.min.js"></script>
	<script src="../static/plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
	<!-- overlayScrollbars -->
	<script src="../static/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
	<!-- AdminLTE App -->
	<script src="../static/dist/js/adminlte.js"></script>
	<!-- DataTables  & Plugins -->
	<script src="../static/plugins/datatables/jquery.dataTables.min.js"></script>
	<script src="../static/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
	<script src="../static/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
	<script src="../static/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
	<script src="../static/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
	<script src="../static/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
	<script src="../static/plugins/jszip/jszip.min.js"></script>
	<script src="../static/plugins/pdfmake/pdfmake.min.js"></script>
	<script src="../static/plugins/pdfmake/vfs_fonts.js"></script>
	<script src="../static/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
	<script src="../static/plugins/datatables-buttons/js/buttons.print.min.js"></script>
	<script src="../static/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.min.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js'></script>


</body>
	<script>
		$(document).ready(function () {

		$(".join_request").on("click", function(){
			var project_id = $(this).attr("data-project-accept");
			var user_id = $(this).attr("data-user-id");
			var noti_id = $(this).attr("data-noti-id")
			
			$.post("{{url_for('project_list')}}", {d_action:"accept_request", noti_id :noti_id, project_id_accept :project_id, user_id_request:user_id}, function(result) {
				location.reload();
			});
		});
	
		var table = $('#example2').DataTable();
		$("#example2").on("click", ".btn_join_project", function(){
			// $( ".btn_join_project" ).on( "click", function() {
			var project_id = $(this).attr("data-project-id");
			var access = $(this).attr("data-access");
			if (access == "Private"){
				$("#modal_label_change").text("Project is Private (password required)")
				$(".modal-body").html('<div class="input-group mb-3"><div class="input-group-prepend">' +
					'<span class="input-group-text">Enter Password</span></div>'+
					'<input id="password" name = "password_enter" type="password" class="form-control" placeholder="Password"' +
					'aria-label="Password" aria-describedby="basic-addon1"></div>')
					$("#comfirm_join").on("click", function(){
						var password = $("#password").val()
						$.post("{{url_for('project_list')}}", {d_action:"insert_password_private", project_id :project_id, access: access, pass: password }, function(result) {
							if (result.data == "success"){
								location.reload();
							}else{
								$(".msg-alert").html('<div class="alert alert-danger" role="alert">The password is wrong</div>').fadeIn().delay(1000).fadeOut();
								$("#password").val("")
							}
						}, "json");
					})
			}else if (access == "Public (Request)"){
					$("#modal_label_change").text("Project need to approve by Admin")
					$(".modal-body").html('<p>Click Join button and we will inform the project manager</p>')
					$.post("{{url_for('project_list')}}", {d_action:"request_exist", project_id :project_id}, function(result) {
							if(result.data == "exist"){
								$(".modal-body").html('<p>You already request to join, Please wait until Project manager accept your request</p>')
								$("#comfirm_join").prop('disabled', true);
							}else{
								$(".modal-body").html('<p>Click Join button and we will inform the project manager</p>')
								$("#comfirm_join").prop('disabled', false);
							}
						}, "json");
					$("#comfirm_join").on("click", function(){
						$.post("{{url_for('project_list')}}", {d_action:"insert_noti", project_id :project_id, access: access}, function(result) {
							if (result.data == "success"){
								location.reload();
							}
						}, "json");
					})
				}else{
					$("#modal_label_change").text("Aavaible Join Project")
					$(".modal-body").html('<p>Click Join button to join this project</p>')
					$.post("{{url_for('project_list')}}", {d_action:"join_public_project", project_id :project_id}, function(result) {
							if (result.data == "success"){
								location.reload();
							}
						}, "json");
					
				}

			 	$('#modal_join').modal('show');
			// });
		});
		// $( ".btn_join_project" ).on( "click", function() {
		// 	var project_id = $(this).attr("data-project-id");
		// 	var access = $(this).attr("data-access");
		// 	if (access == "Private"){
		// 		$("#modal_label_change").text("Project is Private (password required)")
		// 		$(".modal-body").html('<div class="input-group mb-3"><div class="input-group-prepend">' +
		// 			'<span class="input-group-text">Enter Password</span></div>'+
		// 			'<input id="password" name = "password_enter" type="password" class="form-control" placeholder="Password"' +
		// 			'aria-label="Password" aria-describedby="basic-addon1"></div>')
		// 			$("#comfirm_join").on("click", function(){
		// 				var password = $("#password").val()
		// 				$.post("{{url_for('project_list')}}", {d_action:"insert_password_private", project_id :project_id, access: access, pass: password }, function(result) {
		// 					if (result.data == "success"){
		// 						location.reload();
		// 					}else{
		// 						$(".msg-alert").html('<div class="alert alert-danger" role="alert">The password is wrong</div>').fadeIn().delay(1000).fadeOut();
		// 						$("#password").val("")
		// 					}
		// 				}, "json");
		// 			})
		// 	}else if (access == "Public (Request)"){
		// 			$("#modal_label_change").text("Project need to approve by Admin")
		// 			$(".modal-body").html('<p>Click Join button and we will inform the project manager</p>')
		// 			$.post("{{url_for('project_list')}}", {d_action:"request_exist", project_id :project_id}, function(result) {
		// 					if(result.data == "exist"){
		// 						$(".modal-body").html('<p>You already request to join, Please wait until Project manager accept your request</p>')
		// 						$("#comfirm_join").prop('disabled', true);
		// 					}else{
		// 						$(".modal-body").html('<p>Click Join button and we will inform the project manager</p>')
		// 						$("#comfirm_join").prop('disabled', false);
		// 					}
		// 				}, "json");
		// 			$("#comfirm_join").on("click", function(){
		// 				$.post("{{url_for('project_list')}}", {d_action:"insert_noti", project_id :project_id, access: access}, function(result) {
		// 					if (result.data == "success"){
		// 						location.reload();
		// 					}
		// 				}, "json");
		// 			})
		// 		}else{
		// 			$("#modal_label_change").text("Aavaible Join Project")
		// 			$(".modal-body").html('<p>Click Join button to join this project</p>')
		// 			$.post("{{url_for('project_list')}}", {d_action:"join_public_project", project_id :project_id}, function(result) {
		// 					if (result.data == "success"){
		// 						location.reload();
		// 					}
		// 				}, "json");
					
		// 		}

		// 	$('#modal_join').modal('show');
		// } );
	});
	</script>



</html>
